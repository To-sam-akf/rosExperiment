<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <!-- 包含惯性宏，因为我们用到了 box_inertial -->
    <xacro:include filename="$(find urdf_learning)/urdf/inertia_macros.xacro"/>

    <!-- 1. 属性定义 -->
    <!-- PROPERTY LIST -->
    <xacro:property name="A1M8_size" value="0.1"/> <!-- 估算雷达的碰撞体尺寸 -->
    <xacro:property name="A1M8_mass" value="0.2"/>  <!-- 0.2kg -->

    <!-- 2. 宏定义 -->
    <!-- Macro for rplidar A1M8 -->
    <xacro:macro name="rplidar_A1M8">
        <link name="laser_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <!-- 使用提供的3D模型文件进行可视化 -->
                    <mesh filename="package://urdf_learning/meshes/rplidar.dae"/>
                </geometry>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <box size="${A1M8_size} ${A1M8_size} ${A1M8_size}"/>
                </geometry>
            </collision>
            <xacro:box_inertial m="${A1M8_mass}" x="${A1M8_size}" y="${A1M8_size}" z="${A1M8_size}"/>
        </link>

        <!-- 3. Gazebo 插件配置 -->
        <gazebo reference="laser_link">
            <sensor type="ray" name="A1M8_sensor">
                <pose>0 0 0 0 0 0</pose>
                <visualize>true</visualize> <!-- 设置为true可以在Gazebo中看到蓝色的激光束 -->
                <update_rate>10</update_rate>
                <ray>
                    <scan>
                        <horizontal>
                            <samples>360</samples>
                            <resolution>1</resolution>
                            <min_angle>-3.14159</min_angle>
                            <max_angle>3.14159</max_angle>
                        </horizontal>
                    </scan>
                    <range>
                        <min>0.15</min>
                        <max>12.0</max>
                        <resolution>0.01</resolution>
                    </range>
                    <noise>
                        <type>gaussian</type>
                        <mean>0.0</mean>
                        <stddev>0.01</stddev>
                    </noise>
                </ray>
                <plugin name="gazebo_rplidar" filename="libgazebo_ros_laser.so">
                    <topicName>/scan</topicName>
                    <frameName>laser_link</frameName>
                </plugin>
            </sensor>
        </gazebo>
    </xacro:macro>

</robot>